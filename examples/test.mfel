let z := 30;

module test (z) {
    let x := 10;
    let y := 20;
    let f := closure() { x + y };
    module m (x,y,z) {
        # shadows x and y (by value)
        let f := closure() { x + y + z };
        #let c2 := @context;
    }
    #let c1 := @context;
}

def bindings(mod) {
    let arr := @array(mod);
    if @type(arr) == "Error" {
        @print(mod)
    } else {
        @print("{ ");
        for binding in @array(mod) {
            let var := binding(0);
            let val := binding(1);
            @print(var, "=");
            bindings(val);
            @print(" ");
        }
        @print("} ");
    }
}

bindings(test); @println();

let test2 := @copy(test); # only works at top level!!!

@set(test,"x",2000);
@println(test.f());
@println(test2.f());
@println(test.m.f());
@println(test2.m.f());

@set(test.m,"x",1000);
@println(test.f());
@println(test2.f());
@println(test.m.f());
@println(test2.m.f());

@bind(test,"q",300);
@println(test.q);
@println(test2.q);

let a := [1,2,3,[4,5,6,[7,8,9]]];
let b := @copy(a);

@println(a);
@println(b);

a(3)(0,14);
a(3)(3)(2,18);

@println(a);
@println(b);
